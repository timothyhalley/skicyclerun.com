---
// filepath: src/components/PostCards.astro
import type { ImageMetadata } from "astro";

export interface Props {
  title: string;
  author: string;
  pubDatetime: string;
  tags: string[];
  description: string;
  cover?: string | ImageMetadata | null; // Accepts string, ImageMetadata, or null
  href: string;
}
const { title, author, pubDatetime, tags, description, cover, href } =
  Astro.props;

// Debug output
// console.log('[PostCards.astro] Rendering:', { title, cover, coverType: typeof cover, coverSrc: typeof cover === "object" && cover ? cover.src : cover });
---

<article class="post-card-container">
  <div class="post-card">
    <div class="post-content">
      <h2 class="mb-3">
        <a
          href={href}
          class="text-2xl md:text-3xl lg:text-4xl font-extrabold text-skin-base hover:text-skin-accent"
          >{title}</a
        >
      </h2>
      <div class="post-meta">
        <span>By {author}</span>
        <span class="date-separator">â€¢</span>
        <time datetime={pubDatetime}
          >{new Date(pubDatetime).toLocaleDateString()}</time
        >
      </div>
      <p class="post-description">
        {description}
      </p>
      <div class="post-tags">
        {
          tags.map((tag) => (
            <a href={`/tags/${tag.toLowerCase()}`} class="post-tag">
              {tag}
            </a>
          ))
        }
      </div>
    </div>
    <div class="post-image">
      {
        cover ? (
          <a href={href} class="image-container">
            <img
              src={
                typeof cover === "object" && cover && "src" in cover
                  ? cover.src
                  : cover
              }
              alt={title}
              loading="lazy"
            />
          </a>
        ) : (
          <div class="no-image">
            <span>No Image</span>
          </div>
        )
      }
    </div>
  </div>
</article>

<style>
  .post-card-container {
    margin-bottom: 2rem;
  }

  .post-card {
    display: flex;
    flex-direction: row;
    align-items: flex-start; /* avoid stretching the image vertically */
    background-color: var(--color-card);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    transform: translateY(3px);
    border: 1px solid var(--color-card-muted);
  }

  .post-content {
    padding: 1.5rem;
    flex: 3;
    display: flex;
    flex-direction: column;
  }

  /* Title styling moved to Tailwind utilities on the element to avoid scoped CSS specificity conflicts */

  .post-meta {
    margin-bottom: 0.75rem;
    color: var(--color-text-muted);
    font-size: 0.9rem;
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .date-separator {
    opacity: 0.6;
  }

  .post-description {
    margin-bottom: 0.5rem; /* tighter spacing to reduce vertical stretch */
    /* remove flex-grow to prevent pushing the image taller */
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    color: var(--color-text-base);
    line-height: 1.5;
  }

  .post-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem; /* buffer space from description */
  }

  .post-tag {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background-color: var(--color-skin-accent);
    color: var(--color-card);
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .post-tag:hover {
    opacity: 0.85;
    transform: translateY(-2px);
  }

  .post-image {
    flex: 0 0 auto; /* fixed-size column */
    width: clamp(140px, 25vw, 220px); /* responsive width */
    aspect-ratio: 1 / 1; /* perfect square */
    background-color: var(--color-card-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    align-self: flex-start; /* keep aligned to top of content */
    border-left: 1px solid var(--color-card-muted);
  }

  .image-container {
    width: 100%;
    aspect-ratio: 1 / 1; /* ensure the container stays square */
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* fill the square without distortion */
    transition: transform 0.3s ease;
  }

  .image-container:hover img {
    transform: scale(1.05);
  }

  .no-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-card-muted);
    color: var(--color-text-muted);
    font-size: 1.2rem;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .post-card {
      flex-direction: column;
    }

    .post-image {
      width: 100%;
      aspect-ratio: 1 / 1; /* keep square on mobile */
      order: -1; /* move image to top */
    }

    .post-content {
      padding: 1.25rem;
    }

    /* Title font-size is controlled via Tailwind utilities on the anchor element */
  }

  /* Defensive rule: ensure anchor title remains large even if other prose rules exist */
  .post-content h2 a,
  .post-content h3 a,
  .post-card h2 a {
    font-size: 1.5rem !important;
    line-height: 1.4 !important;
    font-weight: 800 !important;
    text-decoration: none !important;
  }

  /* Increase specificity to outrank .prose h1/h2 rules when present */
  article.post-card-container .post-card .post-content h2 a {
    font-size: 1.75rem !important;
  }

  /* make sure featured list items are separated if parent spacing fails */
  :global(.featured-list) > li {
    margin-bottom: 1.5rem;
  }
</style>
