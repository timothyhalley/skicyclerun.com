---
import { slugifyStr } from "@utils/slugify";
import Datetime from "@components/Datetime.astro";

const { href, frontmatter, secHeading = true } = Astro.props;
const { title, pubDatetime, modDatetime, description, ogImage, cover } =
  frontmatter;
const viewTransitionName = slugifyStr(title);

// Use cover if available, fallback to ogImage
const cardImage = cover || ogImage;
---

<article class="mb-8">
  <a href={href} class="block no-underline group">
    <div
      class="flex flex-row items-start bg-skin-card rounded-lg overflow-hidden translate-y-[3px] border border-skin-line"
      style="box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);"
    >
      <div class="p-6 flex-[3_3_0%] flex flex-col">
        <h2 class="mb-3">
          <span
            class="text-2xl md:text-3xl lg:text-4xl font-extrabold text-skin-base group-hover:text-skin-accent transition-colors"
            transition:name={viewTransitionName}
          >
            {title}
          </span>
        </h2>
        <div class="mb-3 text-skin-muted text-sm flex gap-2 items-center">
          <time datetime={pubDatetime}>
            {new Date(pubDatetime).toLocaleDateString()}
          </time>
          {
            modDatetime && (
              <>
                <span class="opacity-60">â€¢</span>
                <span class="text-xs opacity-70">
                  Updated: {new Date(modDatetime).toLocaleDateString()}
                </span>
              </>
            )
          }
        </div>
        <p class="mb-2 line-clamp-3 text-skin-base leading-relaxed">
          {description}
        </p>
      </div>
      {
        cardImage && (
          <div class="flex-none w-[clamp(140px,25vw,220px)] aspect-square bg-skin-fill-secondary flex items-center justify-center self-start border-l border-skin-line overflow-hidden">
            <img
              src={
                typeof cardImage === "object" && cardImage && "src" in cardImage
                  ? cardImage.src
                  : cardImage
              }
              alt={title}
              loading="lazy"
              decoding="async"
              class="w-full h-full object-cover object-center transition-transform duration-300 group-hover:scale-105"
            />
          </div>
        )
      }
    </div>
  </a>
</article>
