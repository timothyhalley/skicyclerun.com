---
// filepath: src/layouts/SSRLayout_V1.astro
import { SITE } from "@skicyclerun.config";
import { slugify } from "@utils/slugify";
import Main from "@layouts/Main.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Breadcrumbs from "@components/Breadcrumbs.astro";
import AuthGate from "@components/AuthGate.astro";
import ProtectedContentLoader from "@components/ProtectedContentLoader.tsx";

const { frontmatter } = Astro.props;
const { title, description, ogImage, pubDate, updatedDate } = frontmatter;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const socialImage = new URL(ogImage ?? `/og-fallback.png`, Astro.url.origin)
  .href;
---

<Main
  title={title}
  description={description}
  image={socialImage}
  canonicalURL={canonicalURL}
>
  <Header activeNav="posts" />
  <Breadcrumbs />
  <div id="content-wrapper" class="mx-auto max-w-3xl px-4 sm:px-6">
    <main id="main-content">
      <AuthGate auth_required={true}>
        <div id="protected-content-container" class="prose dark:prose-invert">
          <p>Loading protected content...</p>
        </div>
        <ProtectedContentLoader client:load />
      </AuthGate>
    </main>
  </div>
  <Footer />
</Main>
