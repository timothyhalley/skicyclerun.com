---
import { SkiCycleRunConfig } from "skicyclerun.config";
import Breadcrumbs from "@layouts/Breadcrumbs.astro";
import Header from "@components/Header.astro";
import BaseLayout from "./BaseLayout.astro";
import type { SvgComponent } from "astro/types";

// Import SVG assets as Astro components using glob
const svgImages = import.meta.glob<SvgComponent>("/src/assets/svg_imgs/*.svg", {
  eager: true,
  import: "default",
});

export interface Props {
  frontmatter: {
    title: string;
    description?: string;
    background?: string;
  };
}

const { frontmatter } = Astro.props;

// Get background SVG component
let BackgroundSvg: SvgComponent | undefined = undefined;

if (frontmatter.background) {
  // Handle both full path and short name references
  const imageName = frontmatter.background.includes("/")
    ? frontmatter.background.split("/").pop()
    : frontmatter.background;

  // Remove .svg extension if present for matching
  const cleanName = imageName?.replace(".svg", "");

  // Find matching SVG in imported assets
  for (const [path, component] of Object.entries(svgImages)) {
    if (path.includes(`/${cleanName}.svg`)) {
      BackgroundSvg = component;
      break;
    }
  }
}
---

<BaseLayout title={`${frontmatter.title} | ${SkiCycleRunConfig.title}`}>
  <Header activeNav="about" />
  <Breadcrumbs pageTitle={frontmatter.title} pageDesc={frontmatter.description}>
    <div class="relative w-full">
      {
        BackgroundSvg && (
          <div class="fixed inset-0 z-0 flex items-center justify-center overflow-hidden pointer-events-none">
            <BackgroundSvg class="w-full h-full opacity-[0.08] grayscale contrast-50 dark:invert dark:opacity-[0.06]" />
          </div>
        )
      }
      <article
        class="prose prose-lg prose-headings:font-semibold prose-h2:text-2xl prose-h2:mt-8 prose-h2:mb-4 prose-p:my-4 prose-a:text-skin-accent prose-a:underline max-w-none relative z-10 leading-relaxed text-skin-base"
      >
        <slot />
      </article>
    </div>
  </Breadcrumbs>
</BaseLayout>

<style>
  /* Minimal overrides - use Tailwind */
  .prose a {
    color: rgb(var(--color-accent));
    text-decoration: underline;
    text-underline-offset: 0.2em;
    text-decoration-thickness: 1px;
    transition: text-decoration-thickness 0.2s ease;
  }

  .prose a:hover {
    text-decoration-thickness: 2px;
  }
</style>
