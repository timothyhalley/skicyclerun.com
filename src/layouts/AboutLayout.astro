---
import { SkiCycleRunConfig } from "skicyclerun.config";
import Breadcrumbs from "@layouts/Breadcrumbs.astro";
import Header from "@components/Header.astro";
import BaseLayout from "./BaseLayout.astro";
import type { SvgComponent } from "astro/types";

// Import SVG assets as Astro components using glob
const svgImages = import.meta.glob<SvgComponent>("/src/assets/svg_imgs/*.svg", {
  eager: true,
  import: "default",
});

export interface Props {
  frontmatter: {
    title: string;
    description?: string;
    background?: string;
  };
}

const { frontmatter } = Astro.props;

// Get background SVG component
let BackgroundSvg: SvgComponent | undefined = undefined;

if (frontmatter.background) {
  // Handle both full path and short name references
  const imageName = frontmatter.background.includes("/")
    ? frontmatter.background.split("/").pop()
    : frontmatter.background;

  // Remove .svg extension if present for matching
  const cleanName = imageName?.replace(".svg", "");

  // Find matching SVG in imported assets
  for (const [path, component] of Object.entries(svgImages)) {
    if (path.includes(`/${cleanName}.svg`)) {
      BackgroundSvg = component;
      break;
    }
  }
}
---

<BaseLayout title={`${frontmatter.title} | ${SkiCycleRunConfig.title}`}>
  <Header activeNav="about" />
  <Breadcrumbs pageTitle={frontmatter.title} pageDesc={frontmatter.description}>
    <section
      id="about"
      class={`prose max-w-none mb-28 prose-img:border-0 relative ${BackgroundSvg ? "has-background" : ""}`}
    >
      {
        BackgroundSvg && (
          <div class="absolute inset-0 z-0 flex items-center justify-center overflow-hidden pointer-events-none">
            <BackgroundSvg class="w-4/5 h-auto opacity-[0.14] grayscale contrast-[65%] mix-blend-multiply dark:invert dark:contrast-75 dark:mix-blend-normal dark:opacity-[0.14]" />
          </div>
        )
      }
      {
        BackgroundSvg && (
          <div class="absolute inset-0 z-[1] bg-skin-fill/35 dark:bg-black/[0.18] pointer-events-none" />
        )
      }
      <div class="relative z-[2] leading-relaxed mt-6">
        <slot />
      </div>
    </section>
  </Breadcrumbs>
</BaseLayout>

<style>
  /* Minimal overrides - use Tailwind */
  .prose a {
    color: rgb(var(--color-accent));
    text-decoration: underline;
    text-underline-offset: 0.2em;
    text-decoration-thickness: 1px;
    transition: text-decoration-thickness 0.2s ease;
  }

  .prose a:hover {
    text-decoration-thickness: 2px;
  }
</style>
